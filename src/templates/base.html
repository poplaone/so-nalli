<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>{% block title %}Student Management System{% endblock %}</title>
    
    <!-- Preconnect to external domains for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    
    <!-- Meta tags for better SEO and mobile experience -->
    <meta name="description" content="Modern Student Management System - NIELIT Project">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
</head>
<body{% if request.endpoint == 'index' %} class="hero-page"{% endif %}>
    <!-- Ultra Modern Navigation -->
    <nav class="modern-navbar" id="mainNavbar">
        <div class="navbar-container">
            <div class="navbar-wrapper">
                <!-- Brand -->
                <div class="navbar-brand-section">
                    <a href="{{ url_for('index') }}" class="modern-brand">
                        <div class="brand-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="brand-text">
                            <span class="brand-name">Student MS</span>
                            <span class="brand-subtitle">Management System</span>
                        </div>
                    </a>
                </div>
                
                {% if session.admin_id %}
                <!-- Desktop Navigation -->
                <div class="navbar-menu-desktop">
                    <div class="nav-items">
                        <a href="{{ url_for('dashboard') }}" class="nav-item {{ 'active' if request.endpoint == 'dashboard' }}">
                            <div class="nav-icon">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <span class="nav-text">Dashboard</span>
                        </a>
                        <a href="{{ url_for('students') }}" class="nav-item {{ 'active' if request.endpoint == 'students' }}">
                            <div class="nav-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <span class="nav-text">Students</span>
                        </a>
                        <a href="{{ url_for('courses') }}" class="nav-item {{ 'active' if request.endpoint == 'courses' }}">
                            <div class="nav-icon">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <span class="nav-text">Courses</span>
                        </a>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="user-menu">
                        <div class="user-profile">
                            <div class="user-avatar">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="user-info">
                                <span class="user-name">Sonal Chauhan</span>
                                <span class="user-role">Administrator</span>
                            </div>
                        </div>
                        <a href="{{ url_for('logout') }}" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                {% else %}
                <!-- Login Button for Non-authenticated Users -->
                <div class="navbar-auth">
                    <a href="{{ url_for('login') }}" class="login-btn">
                        <i class="fas fa-sign-in-alt me-2"></i>Admin Login
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        
        {% if session.admin_id %}
        <!-- Mobile Navigation Menu -->
        <div class="mobile-nav-menu" id="mobileNavMenu">
            <div class="mobile-nav-header">
                <div class="mobile-user-profile">
                    <div class="mobile-user-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="mobile-user-info">
                        <h6>Sonal Chauhan</h6>
                        <p>Administrator</p>
                    </div>
                </div>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mobile-nav-items">
                <a href="{{ url_for('dashboard') }}" class="mobile-nav-item {{ 'active' if request.endpoint == 'dashboard' }}">
                    <div class="mobile-nav-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <span>Dashboard</span>
                    <i class="fas fa-chevron-right mobile-nav-arrow"></i>
                </a>
                <a href="{{ url_for('students') }}" class="mobile-nav-item {{ 'active' if request.endpoint == 'students' }}">
                    <div class="mobile-nav-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <span>Students</span>
                    <i class="fas fa-chevron-right mobile-nav-arrow"></i>
                </a>
                <a href="{{ url_for('courses') }}" class="mobile-nav-item {{ 'active' if request.endpoint == 'courses' }}">
                    <div class="mobile-nav-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <span>Courses</span>
                    <i class="fas fa-chevron-right mobile-nav-arrow"></i>
                </a>
                <div class="mobile-nav-divider"></div>
                <a href="{{ url_for('logout') }}" class="mobile-nav-item logout">
                    <div class="mobile-nav-icon">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                    <span>Logout</span>
                    <i class="fas fa-chevron-right mobile-nav-arrow"></i>
                </a>
            </div>
        </div>
        
        <!-- Mobile Menu Overlay -->
        <div class="mobile-nav-overlay" id="mobileNavOverlay"></div>
        {% endif %}
    </nav>

    <!-- Modern Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Hidden flash messages for JavaScript processing -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flashMessages" style="display: none;">
                {% for category, message in messages %}
                    <div data-category="{{ 'error' if category == 'error' else category }}" data-message="{{ message }}"></div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-light text-center py-4 mt-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 text-md-start text-center mb-2 mb-md-0">
                    <p class="mb-0 text-muted">
                        &copy; 2024 Student Management System
                    </p>
                </div>
                <div class="col-md-6 text-md-end text-center">
                    <p class="mb-0 text-muted">
                        NIELIT O-Level Project by <strong>Sonal Chauhan</strong>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    
    <!-- Additional Scripts -->
    <script>
        // Modern Toast Notification System
        class ToastManager {
            constructor() {
                this.container = document.getElementById('toastContainer');
                this.toasts = [];
            }
            
            show(message, type = 'info', duration = 4000) {
                const toast = this.createToast(message, type, duration);
                this.container.appendChild(toast);
                this.toasts.push(toast);
                
                // Trigger animation
                setTimeout(() => toast.classList.add('show'), 100);
                
                // Auto remove
                setTimeout(() => this.remove(toast), duration);
                
                return toast;
            }
            
            createToast(message, type, duration) {
                const toast = document.createElement('div');
                toast.className = `toast-notification toast-${type}`;
                
                const icons = {
                    success: 'fas fa-check',
                    error: 'fas fa-times',
                    warning: 'fas fa-exclamation',
                    info: 'fas fa-info'
                };
                
                const titles = {
                    success: 'Success',
                    error: 'Error',
                    warning: 'Warning',
                    info: 'Information'
                };
                
                toast.innerHTML = `
                    <div class="toast-header">
                        <div class="toast-title">
                            <div class="toast-icon">
                                <i class="${icons[type]}"></i>
                            </div>
                            ${titles[type]}
                        </div>
                        <button class="toast-close" onclick="toastManager.remove(this.closest('.toast-notification'))">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <p class="toast-message">${message}</p>
                    <div class="toast-progress"></div>
                `;
                
                return toast;
            }
            
            remove(toast) {
                if (!toast || !toast.parentNode) return;
                
                toast.classList.add('hide');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                    this.toasts = this.toasts.filter(t => t !== toast);
                }, 400);
            }
            
            clear() {
                this.toasts.forEach(toast => this.remove(toast));
            }
        }
        
        // Initialize toast manager
        const toastManager = new ToastManager();
        
        // Modern navbar scroll effect and flash message processing
        document.addEventListener('DOMContentLoaded', function() {
            const navbar = document.getElementById('mainNavbar');
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('.navbar-collapse');
            
            // Process flash messages
            const flashMessages = document.getElementById('flashMessages');
            if (flashMessages) {
                const messages = flashMessages.querySelectorAll('[data-category]');
                messages.forEach(msg => {
                    const category = msg.getAttribute('data-category');
                    const message = msg.getAttribute('data-message');
                    toastManager.show(message, category);
                });
            }
            
            // Navbar scroll effect
            function handleScroll() {
                if (window.scrollY > 50) {
                    navbar.classList.add('scrolled');
                    navbar.classList.remove('hero-nav');
                } else {
                    navbar.classList.remove('scrolled');
                    if (document.querySelector('.hero-section')) {
                        navbar.classList.add('hero-nav');
                    }
                }
            }
            
            // Initialize navbar state
            if (document.querySelector('.hero-section')) {
                navbar.classList.add('hero-nav');
            } else {
                navbar.classList.add('scrolled');
            }
            
            window.addEventListener('scroll', handleScroll);
            
            // Mobile menu enhancement
            if (navbarToggler && navbarCollapse) {
                // Close mobile menu when clicking on a link
                const navLinks = navbarCollapse.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        if (navbarCollapse.classList.contains('show')) {
                            navbarToggler.click();
                        }
                    });
                });
            }
        });
        
        // Global toast function for easy access
        window.showToast = function(message, type = 'info') {
            toastManager.show(message, type);
        };
        
        // Mobile Menu Toggle Functionality
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const mobileNavMenu = document.getElementById('mobileNavMenu');
        const mobileNavOverlay = document.getElementById('mobileNavOverlay');
        const mobileNavClose = document.getElementById('mobileNavClose');
        
        if (mobileMenuToggle && mobileNavMenu && mobileNavOverlay) {
            // Toggle mobile menu
            function toggleMobileMenu() {
                const isActive = mobileNavMenu.classList.contains('active');
                
                if (isActive) {
                    // Close menu
                    mobileMenuToggle.classList.remove('active');
                    mobileNavMenu.classList.remove('active');
                    mobileNavOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    // Open menu
                    mobileMenuToggle.classList.add('active');
                    mobileNavMenu.classList.add('active');
                    mobileNavOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }
            
            // Event listeners
            mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            mobileNavOverlay.addEventListener('click', toggleMobileMenu);
            if (mobileNavClose) {
                mobileNavClose.addEventListener('click', toggleMobileMenu);
            }
            
            // Close menu when clicking on nav links
            const mobileNavItems = mobileNavMenu.querySelectorAll('.mobile-nav-item');
            mobileNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    setTimeout(toggleMobileMenu, 100); // Small delay for better UX
                });
            });
            
            // Close menu on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && mobileNavMenu.classList.contains('active')) {
                    toggleMobileMenu();
                }
            });
            
            // Close menu on window resize if open
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 992 && mobileNavMenu.classList.contains('active')) {
                    toggleMobileMenu();
                }
            });
        }
    </script>
</body>
</html>